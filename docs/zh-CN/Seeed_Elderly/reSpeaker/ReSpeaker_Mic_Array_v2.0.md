---
description: ReSpeaker Mic Array v2.0
title: ReSpeaker Mic Array v2.0
keywords:
- ReSpeaker
image: https://files.seeedstudio.com/wiki/wiki-platform/S-tempor.png
slug: /cn/ReSpeaker_Mic_Array_v2.0
date: 4/14/2023
author: H
sku: 107990053
---
<!-- ---
name: ReSpeaker Mic Array v2.0
category: ReSpeaker
bzurl:
oldwikiname: ReSpeaker Mic Array v2.0
prodimagename:
surveyurl:
sku: 107990053
--- -->

![](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/img/usb_4_mic_array.png)

Seeed çš„ ReSpeaker Mic Array v2.0 æ˜¯åŸºäº XVSM-2000 çš„ ReSpeaker Mic Array v1.0 çš„å‡çº§ç‰ˆæœ¬ã€‚v2.0 æ˜¯åŸºäº XMOS çš„ XVF-3000 å¼€å‘ã€‚å®ƒå¯ä»¥å †å  (è¿æ¥) åˆ° ReSpeaker Core çš„é¡¶éƒ¨ï¼Œæ˜¾ç€æ”¹å–„è¯­éŸ³äº¤äº’ä½“éªŒã€‚è¯¥ä¸»æ¿é›†æˆäº† 4 ä¸ª PDM éº¦å…‹é£ï¼Œæœ‰åŠ©äºå°† ReSpeaker çš„å£°å­¦ DSP æ€§èƒ½æé«˜åˆ°æ›´é«˜çš„æ°´å¹³ã€‚

ReSpeaker Mic Array v2.0 ç›´æ¥æ”¯æŒ USB Audio Class 1.0 (UAC 1.0)ã€‚æ‰€æœ‰ä¸»æµçš„æ“ä½œç³»ç»Ÿï¼Œå¦‚ Windowsï¼ŒMacOSï¼ŒLinux éƒ½ä¸ UAC 1.0 å…¼å®¹ï¼Œå› æ­¤å®ƒå¯ä»¥ä½œä¸ºå£°å¡è¿è¡Œè€Œæ— éœ€ ReSpeaker Coreï¼Œä½†å…·æœ‰è¯­éŸ³ç®—æ³•ã€‚

ReSpeaker Mic Array v2.0 æœ‰ä¸¤ä¸ªå›ºä»¶ï¼Œä¸€ä¸ªåŒ…å«è¯­éŸ³ç®—æ³•ï¼Œå¦ä¸€ä¸ªä»…æ•è·ç”¨äºç‰¹æ®Šç”¨é€”çš„åŸå§‹è¯­éŸ³æ•°æ®ã€‚

<!-- ![](https://files.seeedstudio.com/wiki/wiki_chinese/docs/images/click_to_buy.PNG) -->
<div class="get_one_now_container" style={{textAlign: 'center'}}>
    <a class="get_one_now_item" href="https://www.seeedstudio.com/SeeedStudio-BeagleBone-Green-Wireless-p-2650.html">
            <strong><span><font color={'FFFFFF'} size={"4"}> è¯·ç‚¹å‡»æ­¤å¤„è´­ä¹° ğŸ–±ï¸</font></span></strong>
    </a>
</div>

## ç‰ˆæœ¬æ—¥å¿—

| äº§å“ç‰ˆæœ¬          | ç‰ˆæœ¬ä»‹ç»                                                                  | å‘å¸ƒæ—¥æœŸ |
|--------------------------|--------------------------------------------------------------------------|---------------|
| ReSpeaker Mic Array v1.0 | åˆå§‹ç‰ˆæœ¬                                                                  | 2016 å¹´ 8 æœˆ 15 æ—¥ |
| ReSpeaker Mic Array v2.0 | MCU æ›´æ¢ä¸º XVF-3000ï¼ŒMic ä» 7 å‡å°‘åˆ° 4 | 2018 å¹´ 1 æœˆ 25 æ—¥  |

## äº§å“ç‰¹æ€§

- è¿œåœºè¯­éŸ³æ•è·
- UAC 1.0
- å››éº¦é˜µåˆ—
- 12 ä¸ªå¯ç¼–ç¨‹ RGB LED æŒ‡ç¤ºç¯
- è¯­éŸ³ç®—æ³•å’ŒåŠŸèƒ½
- è¯­éŸ³æ´»åŠ¨æ£€æµ‹ Voice Activity Detection
- DOA(åªèƒ½è¾“å‡ºè§’åº¦)
- æ³¢æŸæˆå½¢
- å™ªå£°æŠ‘åˆ¶
- æ¶ˆæ··å“
- å£°å­¦å›å£°æ¶ˆé™¤

## è§„æ ¼å‚æ•°

<!-- <style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-yw4l{vertical-align:top}
</style> -->
<table className="tg" style={{tableLayout: 'fixed', width: 518}}>
  <colgroup>
    <col style={{width: 151}} />
    <col style={{width: 367}} />
  </colgroup>
  <tbody><tr>
      <th className="tg-031e">é¡¹</th>
      <th className="tg-031e">å‚æ•°</th>
    </tr>
    <tr>
      <td className="tg-031e" rowSpan={7}>16 å†…æ ¸ XVF-3000</td>
      <td className="tg-031e">2 ä¸ª xCore ç£è´´ä¸Šçš„ 16 ä¸ªå®æ—¶é€»è¾‘æ ¸å¿ƒ</td>
    </tr>
    <tr>
      <td className="tg-031e">dual issue æ¨¡å¼ä¸‹å†…æ ¸å…±äº«æœ€é«˜å¯è¾¾ 2400 MIPS</td>
    </tr>
    <tr>
      <td className="tg-yw4l">512KB å†…éƒ¨å•å‘¨æœŸ SRAM å’Œ 2MB å†…ç½®é—ªå­˜</td>
    </tr>
    <tr>
      <td className="tg-yw4l">16KB å†…éƒ¨ OTP (æ¯å—æœ€å¤§ 8KB)</td>
    </tr>
    <tr>
      <td className="tg-yw4l">USB PHYï¼Œå®Œå…¨ç¬¦åˆ USB 2.0 è§„èŒƒ</td>
    </tr>
    <tr>
      <td className="tg-yw4l">å¯ç¼–ç¨‹ I/O</td>
    </tr>
    <tr>
      <td className="tg-yw4l">æ”¯æŒ DFU æ¨¡å¼</td>
    </tr>
    <tr>
      <td className="tg-yw4l" rowSpan={7}>4 ä¸ªæ•°å­—éº¦å…‹é£ (å‹å· : MP34DT01-M)</td>
      <td className="tg-yw4l">å•ç”µæºç”µå‹</td>
    </tr>
    <tr>
      <td className="tg-yw4l">ä½åŠŸè€—</td>
    </tr>
    <tr>
      <td className="tg-yw4l">120 dB SPL å£°å­¦è¿‡è½½ç‚¹</td>
    </tr>
    <tr>
      <td className="tg-yw4l">61 dB ä¿¡å™ªæ¯”</td>
    </tr>
    <tr>
      <td className="tg-yw4l">å…¨æ–¹ä½çš„çµæ•åº¦</td>
    </tr>
    <tr>
      <td className="tg-yw4l">-26 dB FS çµæ•åº¦</td>
    </tr>
    <tr>
      <td className="tg-yw4l">PDM è¾“å‡º</td>
    </tr>
    <tr>
      <td className="tg-yw4l" rowSpan={2}>12 RGB LEDs (å‹å· : APA102)</td>
      <td className="tg-yw4l">256 çº§äº®åº¦</td>
    </tr>
    <tr>
      <td className="tg-yw4l">800kHz çº¿è·¯æ•°æ®ä¼ è¾“</td>
    </tr>
    <tr>
      <td className="tg-yw4l" rowSpan={4}>éŸ³é¢‘è¾“å‡º</td>
      <td className="tg-yw4l">æ¿è½½ 3.5mm Aux è¾“å‡º</td>
    </tr>
    <tr>
      <td className="tg-yw4l">WOLFSON WM8960</td>
    </tr>
    <tr>
      <td className="tg-yw4l">24 ä½æˆ– 16 ä½ 16kHz ç«‹ä½“å£°è¾“å‡º</td>
    </tr>
    <tr>
      <td className="tg-yw4l">16 â„¦ @ 3.3 V ä¸‹è¾“å‡ºåŠŸç‡ä¸º 40mW</td>
    </tr>
    <tr>
      <td className="tg-yw4l">å°ºå¯¸</td>
      <td className="tg-yw4l">ç›´å¾„ 70mm</td>
    </tr>
    <tr>
      <td className="tg-yw4l" rowSpan={2}>åŠŸç‡</td>
      <td className="tg-yw4l">Micro USB æˆ–æ‰©å±•æ¥å¤´ä¾› 5V ç”µæº</td>
    </tr>
    <tr>
      <td className="tg-yw4l">åŠŸè€— 190mA</td>
    </tr>
  </tbody></table>

## ç¡¬ä»¶æ¦‚è¿°

![](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/img/Hardware%20Overview.png)

- <font face="" size={3} font color="ff0000">â‘ </font> **XMOS XVF-3000 :**
å®ƒé›†æˆäº†å…ˆè¿›çš„ DSP ç®—æ³•ï¼ŒåŒ…æ‹¬å£°å­¦å›å£°æ¶ˆé™¤ (AEC)ï¼Œæ³¢æŸæˆå½¢ï¼Œå»æ··å“ï¼Œå™ªå£°æŠ‘åˆ¶å’Œå¢ç›Šæ§åˆ¶ã€‚

- <font face="" size={3} font color="ff0000">â‘¡</font> **Digital Microphone :**
MP34DT01-M æ˜¯ä¸€æ¬¾è¶…å°å‹ï¼Œä½åŠŸè€—ï¼Œå…¨æ–¹ä½çš„æ•°å­— MEMS éº¦å…‹é£ï¼Œå†…ç½®ç”µå®¹å¼æ„Ÿåº”å…ƒä»¶å’Œ IC æ¥å£ã€‚

- <font face="" size={3} font color="ff0000">â‘¢</font> **RGB LED :**
ä¸‰è‰² RGB LEDã€‚

- <font face="" size={3} font color="ff0000">â‘£</font> **USB Port :**
æä¾›ç”µæºå¹¶æ§åˆ¶éº¦å…‹é£é˜µåˆ—ã€‚

- <font face="" size={3} font color="ff0000">â‘¤</font> **3.5mm Headphone jack :**
è¾“å‡ºéŸ³é¢‘ï¼Œæˆ‘ä»¬å¯ä»¥å°†æœ‰æºéŸ³å“æˆ–è€³æœºæ’å…¥æ­¤ç«¯å£ã€‚

- <font face="" size={3} font color="ff0000">â‘¥</font> **WM8960 :**
WM8960 æ˜¯ä¸€æ¬¾ä½åŠŸè€—ç«‹ä½“å£°ç¼–è§£ç å™¨ï¼Œé‡‡ç”¨ D ç±»æ‰¬å£°å™¨é©±åŠ¨å™¨ï¼Œå¯ä¸ºæ¯ä¸ªé€šé“æä¾› 1 Wï¼Œæ€»è®¡ 8 W çš„è´Ÿè½½ã€‚

### å¼•è„šå›¾

![](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/img/Pin_Map.png)

## å°ºå¯¸å›¾

![](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/img/Dimension.png)

![](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/img/Dimension1.png)

## åˆ›æ„åº”ç”¨

- USB è¯­éŸ³æ•è·
- æ™ºèƒ½éŸ³å“
- æ™ºèƒ½è¯­éŸ³åŠ©ç†ç³»ç»Ÿ
- å½•éŸ³æœº
- è¯­éŸ³ä¼šè®®ç³»ç»Ÿ
- ä¼šè®®é€šä¿¡è®¾å¤‡
- è¯­éŸ³äº’åŠ¨æœºå™¨äºº
- è½¦è½½è¯­éŸ³åŠ©æ‰‹
- å…¶ä»–éœ€è¦è¯­éŸ³å‘½ä»¤çš„åœºæ™¯

## å…¥é—¨æŒ‡å¯¼

!!!Note
    ReSpeaker Mic Array v2.0 å…¼å®¹ Windowsï¼ŒMac å’Œ Linux ç³»ç»Ÿã€‚ä»¥ä¸‹è„šæœ¬åœ¨ Python2.7 ä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚

### å®‰è£… DFU å’Œ LED æ§åˆ¶é©±åŠ¨ç¨‹åº  

- **Windows :** éŸ³é¢‘å½•åˆ¶å’Œæ’­æ”¾è¿è¡Œè‰¯å¥½ã€‚Windows ä¸Šä»…éœ€ Libusb-win32 é©±åŠ¨ç¨‹åºæ¥æ§åˆ¶ LED æŒ‡ç¤ºç¯ã€‚æˆ‘ä»¬ä½¿ç”¨ [ä¸€ä¸ªæ–¹ä¾¿çš„å·¥å…· - Zadig](https://zadig.akeo.ie/)ä¸º `SEEED DFU` å’Œ `SEEED Control` å®‰è£… libusb-win32 é©±åŠ¨ç¨‹åº (ReSpeaker Mic Array åœ¨ Windows è®¾å¤‡ç®¡ç†å™¨ä¸­ä¼šæ˜¾ç¤º 2 ä¸ªè®¾å¤‡)ã€‚

![](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/img/usb_4mic_array_driver.png)

!!!Warning
    è¯·ç¡®ä¿é€‰æ‹© libusb-win32ï¼Œè€Œä¸æ˜¯ WinUSB æˆ– libusbKã€‚

- **MAC :** æ— éœ€å®‰è£…é©±åŠ¨
- **Linux :** æ— éœ€å®‰è£…é©±åŠ¨

### æ›´æ–°å›ºä»¶

æœ‰2ä¸ªå›ºä»¶ã€‚ ä¸€ä¸ªåŒ…å« 1 ä¸ªé€šé“æ•°æ®ï¼Œå¦ä¸€ä¸ªåŒ…å« 6 ä¸ªé€šé“æ•°æ®ã€‚è¿™é‡Œæ˜¯å·®å¼‚è¡¨ :

| å›ºä»¶ç‰ˆæœ¬             | é€šé“æ•° | è¯´æ˜                                                                                                                                                                    |
|----------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1_channel_firmware.bin | 1              | ä¸º ASR å¤„ç†éŸ³é¢‘                                                                                                                                                 |
| 6_channels_firmware.bin      | 6              |  é€šé“ 0 : ASR å¤„ç†éŸ³é¢‘ï¼Œé€šé“ 1 : mic1 åŸå§‹æ•°æ®ï¼Œé€šé“ 2 : mic2 åŸå§‹æ•°æ®ï¼Œé€šé“ 3 : mic3 åŸå§‹æ•°æ®ï¼Œé€šé“ 4 : mic4 åŸå§‹æ•°æ®ï¼Œé€šé“ 5 : åˆå¹¶æ’­æ”¾ |

è¿™æ˜¯ audacity åˆ· i6_firmware åçš„å½•éŸ³
![](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/img/Audacity.png)

**å¯¹äº Linux ç³»ç»Ÿ :**  ReSpeaker Mic Array v2.0 æ”¯æŒ USB DFUã€‚æˆ‘ä»¬å¼€å‘äº†ä¸€ä¸ª [python script dfu.py](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/res/dfu.py) æ¥é€šè¿‡ USB æ›´æ–°å›ºä»¶ã€‚

```python
sudo apt-get update
sudo pip install pyusb click
git clone https://github.com/respeaker/usb_4_mic_array.git
cd usb_4_mic_array
sudo python dfu.py --download 1_channel_firmware.bin  # è¿™ä¸ªæ˜¯å‚æ•°å¯ä»¥åœ¨https://github.com/respeaker/usb_4_mic_array.gitä¸ŠæŸ¥çœ‹å¯ä»¥é€‰æ‹©ä¸‹è½½å›ºä»¶å“ˆ
```

è¿™æ˜¯å›ºä»¶ä¸‹è½½ç»“æœã€‚
![](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/img/Download_firmware.png)

**å¯¹äº Windows ç”¨æˆ· :** æˆ‘ä»¬ä¸å»ºè®®ä½¿ç”¨ Windows æ›´æ–°å›ºä»¶ã€‚

### æ§åˆ¶ LED

æˆ‘ä»¬å¯ä»¥é€šè¿‡ USB æ§åˆ¶ ReSpeaker Mic Array V2 çš„ LEDã€‚USB è®¾å¤‡å…·æœ‰ä¾›åº”å•†ç‰¹å®šçš„ç­‰çº§æ¥å£ï¼Œå¯ç”¨äºé€šè¿‡ USB æ§åˆ¶ä¼ è¾“å‘é€æ•°æ®ã€‚æˆ‘ä»¬å¼•ç”¨ [pyusb python library](https://github.com/pyusb/pyusb) å¹¶å‘å¸ƒ [usb_pixel_ring python library](https://github.com/respeaker/pixel_ring/blob/master/pixel_ring/usb_pixel_ring_v2.py)ã€‚

LED æ§åˆ¶å‘½ä»¤ç”± pyusb çš„ usb.core.Device.ctrl_transfer() å‘é€ï¼Œå…¶å‚æ•°å¦‚ä¸‹ :

```
ctrl_transfer(usb.util.CTRL_OUT | usb.util.CTRL_TYPE_VENDOR | usb.util.CTRL_RECIPIENT_DEVICE, 0, command, 0x1C, data, TIMEOUT)

```

è¿™é‡Œæ˜¯ usb_pixel_ring APIsã€‚

| Command | Data                           | API                            | Note                                                                                                              |
|---------|--------------------------------|--------------------------------|-------------------------------------------------------------------------------------------------------------------|
| 0       | [0]                            | pixel_ring.trace()             | trace mode, LEDs changing depends on VAD*and DOA*                                                                |
| 1       | [red, green, blue, 0]          | pixel_ring.mono()              | mono mode, set all RGB LED to a single color, for example Red(0xFF0000), Green(0x00FF00)ï¼Œ Blue(0x0000FF)         |
| 2       | [0]                            | pixel_ring.listen()            | listen mode, similar with trace mode, but not turn LEDs off                                                       |
| 3       | [0]                            | pixel_ring.speak()             | wait mode                                                                                                         |
| 4       | [0]                            | pixel_ring.think()             | speak mode                                                                                                        |
| 5       | [0]                            | pixel_ring.spin()              | spin mode                                                                                                         |
| 6       | [r, g, b, 0] * 12              | pixel_ring.custimize()         | custom mode, set each LED to its own color                                                                        |
| 0x20    | [brightness]                   | pixel_ring.set_brightness()    | set brightness, range: 0x00~0x1F                                                                                  |
| 0x21    | [r1, g1, b1, 0, r2, g2, b2, 0] | pixel_ring.set_color_palette() | set color palette, for example, pixel_ring.set_color_palette(0xff0000, 0x00ff00) together with pixel_ring.think() |
| 0x22    | [vad_led]                      | pixel_ring.set_vad_led()       | set center LED: 0 - off, 1 - on, else - depends on VAD                                                            |
| 0x23    | [volume]                       | pixel_ring.set_volume()        | show volume, range: 0 ~ 12                                                                                        |
| 0x24    | [pattern]                      | pixel_ring.change_pattern()    | set pattern, 0 - Google Home pattern, others - Echo pattern                                                       |

**å¯¹äº Linux ç³»ç»Ÿ :** è¿™é‡Œæ˜¯æ§åˆ¶ LED çš„ç¤ºä¾‹ã€‚

```python
git clone https://github.com/respeaker/pixel_ring.git
cd pixel_ring
sudo python setup.py install
sudo python examples/usb_mic_array.py
```

è¿™é‡Œæ˜¯ usb_mic_array.py çš„ä»£ç ã€‚

```python
import time
from pixel_ring import pixel_ring


if __name__ == '__main__':
    pixel_ring.change_pattern('echo')
    while True:

        try:
            pixel_ring.wakeup()
            time.sleep(3)
            pixel_ring.think()
            time.sleep(3)
            pixel_ring.speak()
            time.sleep(6)
            pixel_ring.off()
            time.sleep(3)
        except KeyboardInterrupt:
            break


    pixel_ring.off()
    time.sleep(1)

```

**å¯¹äº Windows ç³»ç»Ÿ** è¿™é‡Œæ˜¯æ§åˆ¶ LED çš„ç¤ºä¾‹

```python
git clone https://github.com/respeaker/pixel_ring.git
cd pixel_ring/pixel_ring
```

ç”¨ä¸‹é¢çš„ä»£ç åˆ›å»ºä¸€ä¸ª [led_control.py](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/res/led_control.py) å¹¶è¿è¡Œ 'python led_control.py'

```python
from usb_pixel_ring_v2 import PixelRing
import usb.core
import usb.util
import time

dev = usb.core.find(idVendor=0x2886, idProduct=0x0018)
print dev
if dev:
    pixel_ring = PixelRing(dev)

    while True:
        try:
            pixel_ring.wakeup(180)
            time.sleep(3)
            pixel_ring.listen()
            time.sleep(3)
            pixel_ring.think()
            time.sleep(3)
            pixel_ring.set_volume(8)
            time.sleep(3)
            pixel_ring.off()
            time.sleep(3)
        except KeyboardInterrupt:
            break

    pixel_ring.off()

```

:::note
å¦‚æœæ‚¨åœ¨å±å¹•ä¸Šçœ‹åˆ° "None"ï¼Œè¯·é‡æ–°å®‰è£… libusb-win32 é©±åŠ¨ç¨‹åºã€‚
:::

### è°ƒéŸ³

æˆ‘ä»¬å¯ä»¥é…ç½®ä¸€äº›å†…ç½®ç®—æ³•çš„å‚æ•°ã€‚å®ƒé€‚ç”¨äº Linux å’Œ Windowsã€‚

- è·å–å®Œæ•´åˆ—è¡¨å‚æ•° :

```
git clone https://github.com/respeaker/usb_4_mic_array.git
cd usb_4_mic_array
python tuning.py -p
```

- ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å…³é—­è‡ªåŠ¨å¢ç›Šæ§åˆ¶ (AGC) :

```
python tuning.py AGCONOFF 0
```

åŒæ—¶ï¼Œå¯¹åº”liunxæˆ‘ä»¬ä¹Ÿå¯ä»¥å®‰è£…ä¸€ä¸ªå¯è§†åŒ–çš„è°ƒéŸ³è½¯ä»¶

```
sudo apt-get install pavucontrol
```

### æå–è¯­éŸ³

ä½¿ç”¨ [PyAudio python library](https://people.csail.mit.edu/hubert/pyaudio/) é€šè¿‡ USB æå–è¯­éŸ³ã€‚

**å¯¹äº Linux ç³»ç»Ÿ :** å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å½•åˆ¶æˆ–æ’­æ”¾è¯­éŸ³ã€‚

```python
arecord -D plughw:1,0 -f cd test.wav # record, please use the arecord -l to check the card and hardware first
aplay -D plughw:1,0 -f cd test.wav # play, please use the aplay -l to check the card and hardware first
arecord -D plughw:1,0 -f cd |aplay -D plughw:1,0 -f cd # record and play at the same time
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ python è„šæœ¬æ¥æå–è¯­éŸ³ã€‚

- æ­¥éª¤ 1ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡Œä»¥ä¸‹è„šæœ¬æ¥è·å–éº¦å…‹é£é˜µåˆ—çš„è®¾å¤‡ç´¢å¼•å· :

```python
sudo pip install pyaudio
cd ~
nano get_index.py
```

- Step 2, å¤åˆ¶ä¸‹é¢çš„ä»£ç å¹¶ç²˜è´´åˆ° [get_index.py](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/res/get_index.py).

```python
import pyaudio

p = pyaudio.PyAudio()
info = p.get_host_api_info_by_index(0)
numdevices = info.get('deviceCount')

for i in range(0, numdevices):
        if (p.get_device_info_by_host_api_device_index(0, i).get('maxInputChannels')) > 0:
            print "Input Device id ", i, " - ", p.get_device_info_by_host_api_device_index(0, i).get('name')
```

- Step 3, æŒ‰ Ctrl + X é€€å‡ºå¹¶æŒ‰ Y ä¿å­˜ã€‚

- Step 4, è¿è¡Œ 'sudo python get_index.py'ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä¸‹çš„è®¾å¤‡ IDã€‚

```
Input Device id  2  -  ReSpeaker 4 Mic Array (UAC1.0): USB Audio (hw:1,0)
```

- Step 5, å°† `RESPEAKER_INDEX = 2` æ›´æ”¹ä¸ºç´¢å¼•å·ã€‚è¿è¡Œ python è„šæœ¬ [record.py](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/res/record.py) æ¥å½•åˆ¶è¯­éŸ³ã€‚

```python
import pyaudio
import wave

RESPEAKER_RATE = 16000
RESPEAKER_CHANNELS = 1 # change base on firmwares, default_firmware.bin as 1 or i6_firmware.bin as 6
RESPEAKER_WIDTH = 2
# run getDeviceInfo.py to get index
RESPEAKER_INDEX = 2  # refer to input device id
CHUNK = 1024
RECORD_SECONDS = 5
WAVE_OUTPUT_FILENAME = "output.wav"

p = pyaudio.PyAudio()

stream = p.open(
            rate=RESPEAKER_RATE,
            format=p.get_format_from_width(RESPEAKER_WIDTH),
            channels=RESPEAKER_CHANNELS,
            input=True,
            input_device_index=RESPEAKER_INDEX,)

print("* recording")

frames = []

for i in range(0, int(RESPEAKER_RATE / CHUNK * RECORD_SECONDS)):
    data = stream.read(CHUNK)
    frames.append(data)

print("* done recording")

stream.stop_stream()
stream.close()
p.terminate()

wf = wave.open(WAVE_OUTPUT_FILENAME, 'wb')
wf.setnchannels(RESPEAKER_CHANNELS)
wf.setsampwidth(p.get_sample_size(p.get_format_from_width(RESPEAKER_WIDTH)))
wf.setframerate(RESPEAKER_RATE)
wf.writeframes(b''.join(frames))
wf.close()
```

**å¯¹äº Windows ç³»ç»Ÿ:** æˆ‘ä»¬é¦–å…ˆè¿è¡Œå‘½ä»¤ 'pip install pyaudio'ï¼Œç„¶åä½¿ç”¨ [get_index.py](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/res/get_index.py) å’Œ [record.py](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/res/record.py) æ¥æå–è¯­éŸ³ã€‚

:::Warning
å¦‚æœçœ‹åˆ° "Error: %1 is not a valid Win32 application."ï¼Œè¯·å®‰è£… Python Win32 ç‰ˆæœ¬ã€‚
:::

### å®æ—¶å£°æºå®šä½è·Ÿè¸ª

[ODAS](https://github.com/introlab/odas) ä»£è¡¨ Open embeddeD Audition Systemã€‚è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºå£°æºå®šä½ï¼Œè¿½è¸ªï¼Œåˆ†ç¦»å’ŒåæœŸè¿‡æ»¤çš„åº“ã€‚

**å¯¹äº Linux ç”¨æˆ·:**

- Step 1. è·å¾— ODAS å¹¶æ„å»ºå®ƒã€‚

```
sudo apt-get install libfftw3-dev libconfig-dev libasound2-dev libgconf-2-4
sudo apt-get install cmake
git clone https://github.com/introlab/odas.git
mkdir odas/build
cd odas/build
cmake ..
make
```

- Step 2. è·å¾— [ODAS Studio](https://github.com/introlab/odas_web/releases) ç„¶åæ‰“å¼€.

- Step 3. odascore å°†ä½äº odas/bin/odascoreï¼Œé…ç½®æ–‡ä»¶æ˜¯ [odas.cfg](https://raw.githubusercontent.com/respeaker/usb_4_mic_array/master/odas.cfg)ã€‚è¯·æ ¹æ®æ‚¨çš„å£°å¡å·æ›´æ”¹ odas.cfgã€‚

- Step 4. ä½¿ç”¨åŒ…å« 4 å£°é“åŸå§‹éŸ³é¢‘æ•°æ®çš„ i6_firmware.bin æ›´æ–°éº¦å…‹é£é˜µåˆ—ã€‚

![](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/img/live_data.png)

**å¯¹äº Windows ç³»ç»Ÿ :** è¯·å‚è€ƒ [ODAS](https://github.com/introlab/odas).

### åŸºäºæ ‘è“æ´¾çš„free-avs

**step 1. é…ç½®å’Œå®‰è£…ç›¸å…³ä¾èµ–**

```
git clone https://github.com/respeaker/4mics_hat.git
cd ~/4mics_hat
sudo apt install libatlas-base-dev     # å®‰è£… snowboy dependencies
sudo apt install python-pyaudio        # å®‰è£…pyaudioéŸ³é¢‘å¤„ç†åŒ…
pip install ./snowboy*.whl             # å®‰è£… snowboy for KWS
pip install ./webrtc*.whl              # å®‰è£… webrtc for DoA
cd ~/
git clone https://github.com/voice-engine/voice-engine #write by seeed
cd voice-engine/
python setup.py bdist_wheel
pip install dist/*.whl
cd ~/
git clone https://github.com/respeaker/avs
cd avs                                 # install Requirements
python setup.py install
pip install avs==0.5.3
sudo apt install libgstreamer1.0-0
sudo apt install gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly 
sudo apt install gstreamer1.0-libav gstreamer1.0-doc gstreamer1.0-tool
sudo apt install gstreamer1.0-plugins-good
sudo apt install python-gi gir1.2-gstreamer-1.0
pip install tornado==5.1.1
sudo apt install mpg123
```

**step 2. å–å¾—æˆæƒ**

åœ¨ç»ˆç«¯è¿è¡Œ alexa-auth ï¼Œç„¶åç™»é™†è·å–alexaçš„æˆæƒï¼Œ æˆ–è€…è¿è¡Œ dueros-auth è·å–ç™¾åº¦çš„æˆæƒã€‚ æˆæƒçš„æ–‡ä»¶ä¿å­˜åœ¨/home/pi/.avs.jsonã€‚
![](https://files.seeedstudio.com/wiki/ReSpeaker-4-Mic-Array-for-Raspberry-Pi/img/auth.png)

:::note
å¦‚æœæˆ‘ä»¬åœ¨ alexa-auth å’Œ dueros-authä¹‹é—´åˆ‡æ¢, è¯·å…ˆåˆ é™¤ /home/pi/.avs.json ã€‚ è¿™ä¸ªæ˜¯éšè—æ–‡ä»¶ï¼Œè¯·ç”¨ ls -la æ˜¾ç¤ºæ–‡ä»¶ã€‚
:::

**step 3. è®©æˆ‘ä»¬Highèµ·æ¥!**

```
cd ~/4mics_hat
nano ns_kws_doa_alexa_with_light.py
```

æŒ‰ç…§ä¸‹é¢çš„ä¿¡æ¯æ›´æ–°ä¸‹é¢ä»£ç çš„è®¾ç½®:

```
"""
Hands-free Voice Assistant with Snowboy and Alexa Voice Service.

Requirement:
    sudo apt-get install python-numpy
    pip install webrtc-audio-processing
    pip install spidev
"""


import time
import logging
from voice_engine.source import Source
from voice_engine.channel_picker import ChannelPicker
from voice_engine.kws import KWS
from voice_engine.ns import NS
from voice_engine.doa_respeaker_4mic_array import DOA
from avs.alexa import Alexa


def main():
    logging.basicConfig(level=logging.DEBUG)

    src = Source(rate=16000, channels=1, device_name='plughw:1,0')
    ch1 = ChannelPicker(channels=1, pick=1)
    ns = NS(rate=16000, channels=1)
    kws = KWS(model='snowboy')
    doa = DOA(rate=16000)
    alexa = Alexa()


    def on_detected(keyword):
        direction = doa.get_direction()
        logging.info('detected {} at direction {}'.format(keyword, direction))
        alexa.listen()

    kws.on_detected = on_detected

    src.link(ch1)
    ch1.link(ns)
    ns.link(kws)
    kws.link(alexa)

    src.link(doa)

    src.recursive_start()

    while True:
        try:
            time.sleep(1)
        except KeyboardInterrupt:
            break

    src.recursive_stop()


if __name__ == '__main__':
    main()
```

å‡å¦‚éœ€è¦ä½¿ç”¨`mic-array`ä½œä¸ºéŸ³é¢‘è¾“å‡ºå£çš„è¯åˆ™å¦‚ä¸‹å›¾è¿›è¡Œè®¾ç½®
![](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/img/audio-output.png)
è¿è¡Œ`PLAYER=mpg123 python ns_kws_doa_alexa_with_light.py`, æˆ‘ä»¬ä¼šåœ¨ç»ˆç«¯çœ‹åˆ°å¾ˆå¤š debug çš„æ¶ˆæ¯. å½“æˆ‘ä»¬çœ‹åˆ°`status code: 204`çš„æ—¶å€™, è¯·è¯´`snowboy`æ¥å”¤é†’ respeakerã€‚æ¥ä¸‹æ¥ respeaker ä¸Šçš„ led ç¯äº®èµ·æ¥, æˆ‘ä»¬å¯ä»¥è·Ÿä»–å¯¹è¯, æ¯”å¦‚é—®ï¼Œ"è°æ˜¯æœ€å¸…çš„?" æˆ–è€… "æ’­æ”¾åˆ˜å¾·åçš„ç”·äººå“­å§å“­å§ä¸æ˜¯ç½ª"ã€‚å°ä¼™ä¼´ï¼Œå°½æƒ…çš„ High èµ·æ¥å§ã€‚

## FAQ

**Q1: å†…ç½®ç®—æ³•çš„å‚æ•°**

```
pi@raspberrypi:~/usb_4_mic_array $ python tuning.py -p
name   type max min r/w info
-------------------------------
AECFREEZEONOFF   int 1 0 rw Adaptive Echo Canceler updates inhibit.
                                                            0 = Adaptation enabled
                                                            1 = Freeze adaptation, filter only
AECNORM          float 16 0.25 rw Limit on norm of AEC filter coefficients
AECPATHCHANGE    int 1 0 ro AEC Path Change Detection.
                                                            0 = false (no path change detected)
                                                            1 = true (path change detected)
AECSILENCELEVEL  float 1 1e-09 rw Threshold for signal detection in AEC [-inf .. 0] dBov (Default: -80dBov = 10log10(1x10-8))
AECSILENCEMODE   int 1 0 ro AEC far-end silence detection status.
                                                            0 = false (signal detected)
                                                            1 = true (silence detected)
AGCDESIREDLEVEL  float 0.99 1e-08 rw Target power level of the output signal.
                                                            [âˆ’inf .. 0] dBov (default: âˆ’23dBov = 10log10(0.005))
AGCGAIN          float 1000 1 rw Current AGC gain factor.
                                                            [0 .. 60] dB (default: 0.0dB = 20log10(1.0))
AGCMAXGAIN       float 1000 1 rw Maximum AGC gain factor.
                                                            [0 .. 60] dB (default 30dB = 20log10(31.6))
AGCONOFF         int 1 0 rw Automatic Gain Control.
                                                            0 = OFF
                                                            1 = ON
AGCTIME          float 1 0.1 rw Ramps-up / down time-constant in seconds.
CNIONOFF         int 1 0 rw Comfort Noise Insertion.
                                                            0 = OFF
                                                            1 = ON
DOAANGLE         int 359 0 ro DOA angle. Current value. Orientation depends on build configuration.
ECHOONOFF        int 1 0 rw Echo suppression.
                                                            0 = OFF
                                                            1 = ON
FREEZEONOFF      int 1 0 rw Adaptive beamformer updates.
                                                            0 = Adaptation enabled
                                                            1 = Freeze adaptation, filter only
FSBPATHCHANGE    int 1 0 ro FSB Path Change Detection.
                                                            0 = false (no path change detected)
                                                            1 = true (path change detected)
FSBUPDATED       int 1 0 ro FSB Update Decision.
                                                            0 = false (FSB was not updated)
                                                            1 = true (FSB was updated)
GAMMAVAD_SR      float 1000 0 rw Set the threshold for voice activity detection.
                                                            [âˆ’inf .. 60] dB (default: 3.5dB 20log10(1.5))
GAMMA_E          float 3 0 rw Over-subtraction factor of echo (direct and early components). min .. max attenuation
GAMMA_ENL        float 5 0 rw Over-subtraction factor of non-linear echo. min .. max attenuation
GAMMA_ETAIL      float 3 0 rw Over-subtraction factor of echo (tail components). min .. max attenuation
GAMMA_NN         float 3 0 rw Over-subtraction factor of non- stationary noise. min .. max attenuation
GAMMA_NN_SR      float 3 0 rw Over-subtraction factor of non-stationary noise for ASR.
                                                            [0.0 .. 3.0] (default: 1.1)
GAMMA_NS         float 3 0 rw Over-subtraction factor of stationary noise. min .. max attenuation
GAMMA_NS_SR      float 3 0 rw Over-subtraction factor of stationary noise for ASR.
                                                            [0.0 .. 3.0] (default: 1.0)
HPFONOFF         int 3 0 rw High-pass Filter on microphone signals.
                                                            0 = OFF
                                                            1 = ON - 70 Hz cut-off
                                                            2 = ON - 125 Hz cut-off
                                                            3 = ON - 180 Hz cut-off
MIN_NN           float 1 0 rw Gain-floor for non-stationary noise suppression.
                                                            [âˆ’inf .. 0] dB (default: âˆ’10dB = 20log10(0.3))
MIN_NN_SR        float 1 0 rw Gain-floor for non-stationary noise suppression for ASR.
                                                            [âˆ’inf .. 0] dB (default: âˆ’10dB = 20log10(0.3))
MIN_NS           float 1 0 rw Gain-floor for stationary noise suppression.
                                                            [âˆ’inf .. 0] dB (default: âˆ’16dB = 20log10(0.15))
MIN_NS_SR        float 1 0 rw Gain-floor for stationary noise suppression for ASR.
                                                            [âˆ’inf .. 0] dB (default: âˆ’16dB = 20log10(0.15))
NLAEC_MODE       int 2 0 rw Non-Linear AEC training mode.
                                                            0 = OFF
                                                            1 = ON - phase 1
                                                            2 = ON - phase 2
NLATTENONOFF     int 1 0 rw Non-Linear echo attenuation.
                                                            0 = OFF
                                                            1 = ON
NONSTATNOISEONOFF int 1 0 rw Non-stationary noise suppression.
                                                            0 = OFF
                                                            1 = ON
NONSTATNOISEONOFF_SR int 1 0 rw Non-stationary noise suppression for ASR.
                                                            0 = OFF
                                                            1 = ON
RT60             float 0.9 0.25 ro Current RT60 estimate in seconds
RT60ONOFF        int 1 0 rw RT60 Estimation for AES. 0 = OFF 1 = ON
SPEECHDETECTED   int 1 0 ro Speech detection status.
                                                            0 = false (no speech detected)
                                                            1 = true (speech detected)
STATNOISEONOFF   int 1 0 rw Stationary noise suppression.
                                                            0 = OFF
                                                            1 = ON
STATNOISEONOFF_SR int 1 0 rw Stationary noise suppression for ASR.
                                                            0 = OFF
                                                            1 = ON
TRANSIENTONOFF   int 1 0 rw Transient echo suppression.
                                                            0 = OFF
                                                            1 = ON
VOICEACTIVITY    int 1 0 ro VAD voice activity status.
                                                            0 = false (no voice activity)
                                                            1 = true (voice activity)
```

**Q2: ImportError: No module named usb.core**

A2: Run sudo pip install pyusb to install the pyusb.

```
pi@raspberrypi:~/usb_4_mic_array $ sudo python tuning.py DOAANGLE
Traceback (most recent call last):
  File "tuning.py", line 5, in <module>
    import usb.core
ImportError: No module named usb.core
pi@raspberrypi:~/usb_4_mic_array $ sudo pip install pyusb
Collecting pyusb
  Downloading pyusb-1.0.2.tar.gz (54kB)
    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 61kB 101kB/s
Building wheels for collected packages: pyusb
  Running setup.py bdist_wheel for pyusb ... done
  Stored in directory: /root/.cache/pip/wheels/8b/7f/fe/baf08bc0dac02ba17f3c9120f5dd1cf74aec4c54463bc85cf9
Successfully built pyusb
Installing collected packages: pyusb
Successfully installed pyusb-1.0.2
pi@raspberrypi:~/usb_4_mic_array $ sudo python tuning.py DOAANGLE
DOAANGLE: 180
```

**Q3: èƒ½ç›´æ¥é€šè¿‡3.5mmè€³æœºå­”å¬åˆ°é‡‡æ ·çš„å£°éŸ³å—?**

A5 ä¸è¡Œçš„ã€‚3.5mmè€³æœºå­”éŸ³æºæ¥è‡ªäºä¸Šä½æœºï¼Œä½†æ˜¯å¦‚æœç”¨æ ‘è“æ´¾çš„è¯å¯ä»¥é€šè¿‡æ‰§è¡Œarecord -D plughw:1,0 -f cd |aplay -D plughw:1,0 -f cd è¾¾åˆ°ç›®çš„

## èµ„æºä¸‹è½½

- **[äº§å“ç®€ä»‹]** [ReSpeaker MicArray v2.0 Product Brief](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/res/ReSpeaker%20MicArray%20v2.0%20Product%20Brief.pdf)
- **[äº§å“ç®€ä»‹]** [XVF3000 Product Brief](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/res/XVF3000-3100-product-brief_1.4.pdf)
- **[èŠ¯ç‰‡æ•°æ®æ‰‹å†Œ]** [XVF3000 Datasheet](https://files.seeedstudio.com/wiki/ReSpeaker_Mic_Array_V2/res/XVF3000-3100-TQ128-Datasheet_1.0.pdf)

## æŠ€æœ¯æ”¯æŒ

å¦‚æœæ‚¨æœ‰ä»»ä½•æŠ€æœ¯é—®é¢˜ï¼Œè¯·è”ç³» techsupport@seeed.ccã€‚æˆ–è€…å°†é—®é¢˜æäº¤åˆ°æˆ‘ä»¬çš„ [è®ºå›](http://seeedstudio.com/forum/)ã€‚
